# Система управления токенами

Этот проект состоит из двух частей: бота для управления токенами и сервера для их проверки. Бот позволяет администратору генерировать новые токены, очищать просроченные токены и выводить список всех токенов. Сервер предоставляет возможность проверки токенов, включая информацию о времени действия и IP-адресе.

## Функциональность

### 1. **Бот для управления токенами**
  - **Создание токенов**: Администратор может генерировать новые токены с заданным временем жизни.
  - **Список токенов**: Просмотр всех активных токенов с их временем действия и IP-адресами.
  - **Удаление просроченных токенов**: Очищение базы данных от токенов, срок действия которых истек.
  - **Управление через интерфейс Telegram**: Бот работает через Telegram и использует кнопки и команды для управления токенами.
  
### 2. **Сервер для проверки токенов**
  - **Проверка токенов**: Через сервер можно проверить статус токена, его время действия, оставшееся время.
  - **Эндпоинт для проверки**: Используется HTTP GET запрос на `/Tlogin`, где передается токен, а сервер отвечает его состоянием.

## Структура проекта

1. **`client.py`** — клиент для отправки запроса на сервер для проверки токенов.
2. **`bot_token_manager.py`** — основной скрипт для управления токенами через Telegram-бота.
3. **`server.py`** — сервер, который обрабатывает запросы на проверку токенов.
4. **`requirements.txt`** — файл зависимостей для установки необходимых библиотек.

## Установка

### 1. Клонируйте репозиторий

Для начала необходимо клонировать репозиторий на свой локальный компьютер:

```bash
git clone https://github.com/KiAtsushi-Git/TokenAuthentication
cd TokenAuthentication
```

### 2. Установка зависимостей

Создайте виртуальное окружение и установите все необходимые зависимости:

```bash
python -m venv venv
source venv/bin/activate  # Для Windows используйте `venv\Scripts\activate`
pip install -r requirements.txt
```

### 3. Настройка базы данных

Проект использует SQLite для хранения токенов. База данных будет создана автоматически при первом запуске приложения, но вы можете настроить её вручную, если необходимо.

### 4. Запуск сервера

Для того чтобы запустить сервер, используйте команду:

```bash
python server.py
```

Сервер будет доступен по адресу `http://127.0.0.1:1830`.

### 5. Запуск бота

Для запуска бота выполните команду:

```bash
python bot_token_manager.py
```

Бот будет доступен в Telegram и будет управлять токенами через команды и кнопки.

## Использование

### 1. Команды бота

- **`/start`** — запускает бота и выводит меню с доступными действиями (смотреть список токенов, создать новый токен, очистить просроченные токены).
- **`/gen`** — команда для создания нового токена. Бот запросит у администратора время жизни токена в секундах.
- **`/list_tokens`** — выводит список всех активных токенов с временем действия.
- **`/clean_tokens`** — очищает базу данных от просроченных токенов.

### 2. Управление токенами через интерфейс

- Бот предлагает кнопки для создания нового токена с разным временем жизни (например, на 1 час, 24 часа, 48 часов).
- Бот позволяет администратору просматривать список токенов и удалять просроченные.

### 3. Сервер для проверки токенов

С помощью эндпоинта `GET /Tlogin` на сервере можно проверить токен, передав его через параметр запроса:

Пример запроса:

```bash
GET http://127.0.0.1:1830/Tlogin?token=your_token_here
```

Сервер возвращает информацию о токене, если он валидный и не просрочен:

```json
{
    "token": "your_token_here",
    "expiration": "2025-03-29T12:00:00",
    "ip_address": "192.168.1.1",
    "remaining_time": 3600
}
```

Если токен недействителен или истек, сервер вернет ошибку.

## Структура базы данных

В базе данных используется одна таблица `tokens`, которая содержит следующие поля:
- `id` — уникальный идентификатор токена.
- `token` — сам токен.
- `expiration` — дата и время истечения срока действия токена.
- `ip_address` — IP-адрес, связанный с токеном.

## Часто задаваемые вопросы

### Как удалить все просроченные токены?
Для этого используйте команду `/clean_tokens` в боте или нажмите соответствующую кнопку в интерфейсе бота.

### Как изменить настройки базы данных?
Вы можете вручную изменить файл базы данных `tokens.db` или настроить подключение к другой базе данных в коде, если необходимо.

### Как создать токен с кастомным временем жизни?
Вы можете использовать команду `/gen`, чтобы бот запросил время жизни токена в секундах.

## Разворачивание в продакшн

Для того чтобы развернуть проект в продакшн-среде, вам нужно будет:
- Настроить сервер на удаленном хостинге (например, на AWS, DigitalOcean или другом сервере).
- Настроить бота с помощью BotFather в Telegram, если вы хотите использовать его в публичной сети.
